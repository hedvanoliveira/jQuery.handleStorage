/* https://www.github.com/jas-/jQuery.handleStorage */
(function(a){a.fn.handleStorage=function(j){var g={appID:"jQuery.handleStorage",storage:"local",element:a(this),interval:5000,uuid:"",data:{},aes:false,debug:false,callback:function(){},preCallback:function(){},errCallback:function(){}};var b=b||{init:function(l){var k=e.merge(l,g);if(!e.init(k)){d.error(l.appID,"init: An error occured during initialization");return false}return true}};var e=e||{init:function(m){((m.preCallback)&&(a.isFunction(m.preCallback)))?m.preCallback(a(this)):false;m.uuid=(m.aes)?h.key(m):m.uuid;var k=(c.size(f.toJSON(m.data))>0)?m.data:m.element;var l=e.bind(m,k);((m.callback)&&(a.isFunction(m.callback)))?m.callback(a(this)):false;return l},merge:function(l,k){return a.extend({},k,l)},bind:function(m,l){var k=false;c.restore(m,l);switch(true){case (l).is("form"):(m.debug)?d.debug(m.appID,"_setup.get: Currently bound to form ("+l.attr("id")+")"):false;a(l).on("submit",function(n){n.preventDefault();f.save(m,l.attr("id"),c.form(m,l))});k=true;break;case (l).is("div"):(m.debug)?d.debug(m.appID,"_setup.get: Current bound to div ("+l.attr("id")+")"):false;k=true;break;case (l).is("string"):(m.debug)?d.debug(m.appID,"_setup.get: String specified"):false;k=true;break;case (l).is("object"):if(JSON.stringify(l).match(/^\{.*\}$/)){(m.debug)?d.debug(m.appID,"_setup.get: User supplied data specified"):false}k=true;break;default:break}return k}};var f=f||{quota:function(n,m,p){var k=/local|session/.test(m)?1024*1025*5:1024*4;var o=k-unescape(encodeURIComponent(JSON.stringify(m))).length;if(o<=0){d.error(n,"Maximum quota ("+k+"k) for "+m+" has been met, cannot continue");return false}(p)?d.debug(n,"_storage.quota: Maximum quota ("+k+"k) for "+m+" has not been met. Current total: "+o+"k"):false;return true},save:function(q,n,m){var l=false;if(f.quota(q.appID,q.storage,q.debug)){var p=f.retrieve(q,n);if(c.size(p)>0){a.extend(m,p)}m=(q.aes)?sjcl.encrypt(q.uuid,f.fromJSON(m)):f.fromJSON(m);switch(q.storage){case"cookie":this._cookie.save(q,n,m);l=true;break;case"local":this._local.save(q,n,m);l=true;break;case"session":this._session.save(q,n,m);l=true;break;default:this._local.save(q,n,m);l=true;break}}return l},retrieve:function(n,m){var l={};switch(n.storage){case"cookie":l=this._cookie.retrieve(n,m);break;case"local":l=this._local.retrieve(n,m);break;case"session":l=this._session.retrieve(n,m);break;default:l=this._local.retrieve(n,m);break}if(c.size(f.toJSON(l))>0){l=(n.aes)?sjcl.decrypt(n.uuid,l):l;return(/string/.test(typeof(l)))?f.toJSON(l):l}(n.debug)?d.debug(n.appID,'_storage.retrieve: An error occured retrieving "'+m+'" from "'+n.storage+'"'):false;return false},fromJSON:function(k){return(/object/.test(typeof(k)))?JSON.stringify(k):k},toJSON:function(k){return(/string/.test(typeof(k)))?JSON.parse(k):k},_cookie:{save:function(p,m,l){var n=new Date();n.setTime(n.getTime()+(30*24*60*60*1000));document.cookie=m+"="+l+";expires="+n.toGMTString()+";path=/;domain="+this.domain();(p.debug)?d.debug(p.appID,"_cookies.save: "+m+" => "+l):false;return true},retrieve:function(q,m){var n,l,r,p=document.cookie.split(";");for(n=0;n<p.length;n++){l=p[n].substr(0,p[n].indexOf("="));r=p[n].substr(p[n].indexOf("=")+1);l=l.replace(/^\s+|\s+$/g,"");if(l==m){(q.debug)?d.debug(q.appID,"_cookies.retrieve: "+m+" => "+r):false;return unescape(r)}}return false},domain:function(){return location.hostname}},_local:{save:function(n,m,l){(n.debug)?d.debug(n.appID,"_local.save: "+m+" => "+l):false;return localStorage.setItem(m,l)},retrieve:function(n,m){var l=localStorage.getItem(m);(n.debug)?d.debug(n.appID,"_local.retrieve: "+m+" => "+l):false;return(l)?l:false}},_session:{save:function(n,m,l){(n.debug)?d.debug(n.appID,"_session.save: "+m+" => "+l):false;return localStorage.setItem(m,l)},retrieve:function(n,m){var l=sessionStorage.getItem(m);(n.debug)?d.debug(n.appID,"_session.retrieve: "+m+" => "+l):false;return(l)?l:false}}};var h=h||{key:function(l){(l.debug)?d.debug(l.appID,"_crypto.key: Prepared key"):false;var k=h.uid();return sjcl.codec.hex.fromBits(sjcl.misc.pbkdf2(k,h.salt(k),1000,256))},uid:function(){var k=window.navigator.appName+window.navigator.appCodeName+window.navigator.product+window.navigator.productSub+window.navigator.appVersion+window.navigator.buildID+window.navigator.userAgent+window.navigator.language+window.navigator.platform+window.navigator.oscpu;return k.replace(/\s/,"")},salt:function(o){var l=h.iv(o);var m=[];m[0]=sjcl.hash.sha256.hash(o);var n=[];n=m[0];var k;for(i=1;i<3;i++){m[i]=sjcl.hash.sha256.hash(m[i-1].concat(l));k=n.concat(m[i])}return JSON.stringify(sjcl.codec.hex.fromBits(k))},iv:function(k){return(k)?encodeURI(k.replace(/-/gi,"").substring(16,Math.ceil(16*k.length)%k.length)):false}};var c=c||{inspect:function(l,k){a.each(k,function(m,n){if((/object|array/.test(typeof(n)))&&(c.size(n)>0)){(l.debug)?d.debug(l.appID,"_libs.inspect: Examining "+m+" ("+typeof(n)+")"):false;c.inspect(l,n)}else{(l.debug)?d.debug(l.appID,"_libs.inspect: "+m+" => "+n):false}})},size:function(k){var l=0;if(/object/.test(typeof(k))){a.each(k,function(n,m){if(k.hasOwnProperty(n)){l++}})}else{if(/array/.test(typeof(k))){l=k.length}}return l},form:function(m,k){(m.debug)?d.debug(m.appID,"_libs.form: Retrieving form data"):false;var l={};if(c.size(k)>0){a.each(k,function(o,n){a.each(n,function(q,p){if((p.name)&&(p.value)){l[p.name]=(/checkbox|radio/.test(p.type))?c.selected(m,p):p.value}})})}(m.debug)?c.inspect(m,l):false;return(/object/.test(typeof(l)))?JSON.stringify(l):l},selected:function(m,l){var k=a("#"+l.name+":checked").map(function(){return this.value}).get();return c.rdupes(k)},rdupes:function(k){var l=[];if(c.size(k)>0){a.each(k,function(n,m){if(a.inArray(m,l)===-1){l.push(m)}})}return l},restore:function(m,l){var k=f.retrieve(m,l.attr("id"));if((k)&&(c.size(k)>0)){a.each(k,function(o,n){(l.is("form"))?a("#"+l.attr("id")+" #"+o).val(n):a("#"+l.attr("id")+" #"+o).html(n)})}else{(l.is("form"))?a("#"+l.attr("id")).val(k):a("#"+l.attr("id")).html(k)}},guid:function(q){var p="0123456789abcdef".split("");var m=[],l=Math.random,n;m[8]=m[13]=m[18]=m[23]="-";m[14]="4";for(var k=0;k<36;k++){if(!m[k]){n=0|l()*16;m[k]=p[(k==19)?(n&3)|8:n&15]}}return m.join("")}};var d=d||{debug:function(l,k){return(/function/.test(typeof(console.debug)))?console.debug("["+l+"] (DEBUG) "+k):false},info:function(l,k){return(/function/.test(typeof(console.info)))?console.info("["+l+"] (INFO) "+k):false},warn:function(l,k){return(/function/.test(typeof(console.warn)))?console.warn("["+l+"] (WARN) "+k):false},error:function(l,k){return(/function/.test(typeof(console.error)))?console.error("["+l+"] (ERROR) "+k):false}};if(b[j]){return b[j].apply(this,Array.prototype.slice.call(arguments,1))}else{if((typeof j==="object")||(!j)){return b.init.apply(this,arguments)}else{d.error("Method "+j+" does not exist")}}return true}})(jQuery);